"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.dislikeComment=exports.likeComment=exports.editcomment=exports.deletecomment=exports.getcomment=exports.postcomment=void 0;var _comment=_interopRequireDefault(require("../Models/comment.js")),_mongoose=_interopRequireDefault(require("mongoose"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var postcomment=function(t,r){var n,s;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.body,s=new _comment.default(n),e.prev=2,e.next=5,regeneratorRuntime.awrap(s.save());case 5:r.status(200).json("posted the comment"),e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(2),r.status(400).json(e.t0.message),e.abrupt("return");case 12:case"end":return e.stop()}},null,null,[[2,8]])};exports.postcomment=postcomment;var getcomment=function(e,t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,regeneratorRuntime.awrap(_comment.default.find());case 3:r=e.sent,t.status(200).send(r),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),t.status(400).json(e.t0.message),e.abrupt("return");case 11:case"end":return e.stop()}},null,null,[[0,7]])};exports.getcomment=getcomment;var deletecomment=function(t,r){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.id,_mongoose.default.Types.ObjectId.isValid(n)){e.next=3;break}return e.abrupt("return",r.status(400).send("Comments unavailable.."));case 3:return e.prev=3,e.next=6,regeneratorRuntime.awrap(_comment.default.findByIdAndDelete(n));case 6:r.status(200).json({message:"deleted comment"}),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),r.status(400).json(e.t0.message),e.abrupt("return");case 13:case"end":return e.stop()}},null,null,[[3,9]])};exports.deletecomment=deletecomment;var editcomment=function(t,r){var n,s,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.id,s=t.body.commentbody,_mongoose.default.Types.ObjectId.isValid(n)){e.next=4;break}return e.abrupt("return",r.status(400).send("Comments unavailable.."));case 4:return e.prev=4,e.next=7,regeneratorRuntime.awrap(_comment.default.findByIdAndUpdate(n,{$set:{commentbody:s}}));case 7:a=e.sent,r.status(200).json(a),e.next=15;break;case 11:return e.prev=11,e.t0=e.catch(4),r.status(400).json(e.t0.message),e.abrupt("return");case 15:case"end":return e.stop()}},null,null,[[4,11]])};exports.editcomment=editcomment;var likeComment=function(t,r){var n,s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.id,s=t.body.userId,console.log("likeCommentController:",n,{userId:s}),_mongoose.default.Types.ObjectId.isValid(n)){e.next=5;break}return e.abrupt("return",r.status(404).send("Invalid comment ID"));case 5:return e.prev=5,e.next=8,regeneratorRuntime.awrap(_comment.default.findById(n));case 8:if(a=e.sent){e.next=11;break}return e.abrupt("return",r.status(404).send("Comment not found"));case 11:return a.likedBy.includes(s)?(a.likedBy=a.likedBy.filter(function(e){return e!==s}),a.likes-=1):(a.likedBy.push(s),a.likes+=1,a.dislikedBy.includes(s)&&(a.dislikedBy=a.dislikedBy.filter(function(e){return e!==s}),a.dislikes-=1)),e.next=14,regeneratorRuntime.awrap(a.save());case 14:o=e.sent,r.status(200).json(o),e.next=22;break;case 18:e.prev=18,e.t0=e.catch(5),console.error("Error liking comment:",e.t0),r.status(500).json({message:"Server error",error:e.t0.message});case 22:case"end":return e.stop()}},null,null,[[5,18]])};exports.likeComment=likeComment;var dislikeComment=function(t,r){var n,s,a,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.params.id,s=t.body.userId,console.log("dislikeCommentController:",n,{userId:s}),_mongoose.default.Types.ObjectId.isValid(n)){e.next=5;break}return e.abrupt("return",r.status(404).send("Invalid comment ID"));case 5:return e.prev=5,e.next=8,regeneratorRuntime.awrap(_comment.default.findById(n));case 8:if(a=e.sent){e.next=11;break}return e.abrupt("return",r.status(404).send("Comment not found"));case 11:if(a.dislikedBy.includes(s)?(a.dislikedBy=a.dislikedBy.filter(function(e){return e!==s}),a.dislikes-=1):(a.dislikedBy.push(s),a.dislikes+=1,a.likedBy.includes(s)&&(a.likedBy=a.likedBy.filter(function(e){return e!==s}),a.likes-=1)),2<=a.dislikes)return e.next=15,regeneratorRuntime.awrap(_comment.default.findByIdAndDelete(n));e.next=16;break;case 15:return e.abrupt("return",r.status(200).json({message:"Comment removed after 2 likes"}));case 16:return e.next=18,regeneratorRuntime.awrap(a.save());case 18:o=e.sent,r.status(200).json(o),e.next=26;break;case 22:e.prev=22,e.t0=e.catch(5),console.error("Error disliking comment:",e.t0),r.status(500).json({message:"Server error",error:e.t0.message});case 26:case"end":return e.stop()}},null,null,[[5,22]])};exports.dislikeComment=dislikeComment;
//# sourceMappingURL=Comment.min.js.map
